# Описание функции редактирования заказа

**Бизнес-требования и их приоритеты**

![image](https://github.com/cyberlizka/-/assets/164761247/ca245252-f2dd-478c-8db1-a585c2761b45)

**Критерии качества на входе (DoR)**

    1. Бизнес-требования согласованы с заказчиком и руководителем проекта.
    2. Системные требования согласованы с лидом разработки и руководителем проекта.
    3. Задачи поставлены ясно и понятны для всех участников команды, и нет открытых вопросов.
    4. У задачи описаны критерии приемки.
    5. Функциональная спецификация должна быть декомпозирована на задачи продолжительностью не более 16 часов каждая.
    6. К задачам на интеграцию должна быть приложена диаграмма последовательности.
    7. Для каждой задачи должны быть установлены все зависимости.
    
**Acceptance Criteria (AC)**


    1. Пользователь может открыть страницу с деталями заказа для редактирования.
    2. Все поля заказа доступны для редактирования, включая товары, количество, адрес доставки и контактную информацию.
    3. После внесения изменений пользователь должен иметь возможность сохранить отредактированный заказ.
    4. Система должна проверять корректность введенных данных (например, правильность формата email или адреса).
    5. После сохранения изменений пользователь должен видеть подтверждение об успешном обновлении заказа.
    6. Изменения должны быть отражены в базе данных и доступны для просмотра как пользователю, так и администратору.
    7. При возникновении ошибок при сохранении изменений, система должна отобразить соответствующее сообщение об ошибке и предоставить пользователю возможность исправить данные.

**Ограничения**


    1. Не должна быть затронута логика работы с платежными системами при редактировании заказа, чтобы избежать проблем с оплатой.
    2. Не должна быть затронута логика отмены заказов, чтобы не создавать конфликтов с функцией отмены заказов.
    3. Не должна быть затронута логика создания новых заказов, так как функция редактирования должна быть отделена от логики создания новых заказов.
    4. Не должна быть затронута логика авторизации, чтобы доступ к функции редактирования был доступен только авторизованным пользователям.
    
**Концепция решения**

  > функцию редактирования заказа, которая позволит зарегистрированным пользователям вносить изменения в свои заказы после их размещения.
 

**Sequence диаграмма**


![image](https://github.com/cyberlizka/-/assets/164761247/038eae36-e3ce-463a-b4e7-7f6212ecef00)
```
@startuml
participant Клиент
participant Сервер
participant Сервис_Авторизации
participant База_Данных
participant Сервис_Уведомлений

activate Клиент
Клиент -> Сервер: PUT /orders/{orderId} (обновленные данные заказа)
activate Сервер
    Сервер -> Сервис_Авторизации: Проверка авторизации
    activate Сервис_Авторизации
        Сервис_Авторизации --> Сервер: 200 OK (авторизован)
    deactivate Сервис_Авторизации
    
    Сервер -> База_Данных: GET /orders/{orderId} 
    activate База_Данных
        База_Данных --> Сервер: 200 OK (данные заказа)
    deactivate База_Данных

    alt Заказ найден
        Сервер -> База_Данных: Проверка валидности обновленных данных
        activate База_Данных
            База_Данных --> Сервер: 200 OK (данные валидны)
        deactivate База_Данных

        alt Проверка успешна
            Сервер -> База_Данных: PUT /orders/{orderId} (обновленные данные заказа)
            activate База_Данных
                База_Данных --> Сервер: 200 OK (заказ обновлен)
            deactivate База_Данных
            Сервер -> Сервис_Уведомлений: Отправить уведомление об обновлении заказа
            activate Сервис_Уведомлений
                Сервис_Уведомлений --> Сервер: 200 OK (уведомление отправлено)
            deactivate Сервис_Уведомлений
            Сервер -> Клиент: 200 OK (заказ обновлен)
        else Проверка не успешна
            Сервер -> Клиент: 400 Bad Request (некорректные данные)
        end

    else Заказ не найден
        Сервер -> Клиент: 404 Not Found (заказ не найден)
    end

deactivate Сервер
deactivate Клиент

@enduml
```
**Неуспешное редактирование данных**

>Неуспешная проверка данных: В этом сценарии мы предполагаем, что обновленные данные некорректны. Сервер получает ответ 400 Bad Request от Базы Данных, подтверждающий некорректность данных. 

>Отличия от успешного сценария:
>Вместо ответа 200 OK (данные валидны) от Базы Данных, сервер получает 400 Bad Request, что сигнализирует о том, что данные некорректны.
>После неуспешной проверки данных не происходит обновление заказа в Базе Данных.
>Сервер не отправляет уведомления о обновлении заказа в Сервис Уведомлений.
>Сервер возвращает клиенту код ответа 400 Bad Request, а не 200 OK.


![image](https://github.com/cyberlizka/-/assets/164761247/b84e7ff0-d833-4d2b-9c88-cffbd537ef6c)
```
@startuml

participant Клиент
participant Сервер
participant Сервис_Авторизации
participant База_Данных
participant Сервис_Уведомлений

activate Клиент
Клиент -> Сервер: PUT /orders/{orderId} (обновленные данные заказа)
activate Сервер
    Сервер -> Сервис_Авторизации: Проверка авторизации
    activate Сервис_Авторизации
        Сервис_Авторизации --> Сервер: 200 OK (авторизован)
    deactivate Сервис_Авторизации
    
    Сервер -> База_Данных: GET /orders/{orderId} 
    activate База_Данных
        База_Данных --> Сервер: 200 OK (данные заказа)
    deactivate База_Данных

    alt Заказ найден
        Сервер -> База_Данных: Проверка валидности обновленных данных
        activate База_Данных
            База_Данных --> Сервер: 400 Bad Request (некорректные данные)
        deactivate База_Данных

        alt Проверка не успешна
            Сервер -> Клиент: 400 Bad Request (некорректные данные)
        end

    else Заказ не найден
        Сервер -> Клиент: 404 Not Found (заказ не найден)
    end

deactivate Сервер
deactivate Клиент

@enduml

```
**Функциональные требования**

![image](https://github.com/cyberlizka/-/assets/164761247/b5ed8382-bf70-442e-8af1-01449dc32701)

**Use Cases**

![image](https://github.com/cyberlizka/-/assets/164761247/7e6d0b92-0f4f-44d1-a9e8-5a6bd029db32)

![image](https://github.com/cyberlizka/-/assets/164761247/287c9116-d6bd-4d8e-b7ca-17dee3d22066)

**Модели данных**

**Сущности системы и их связи (ERD): Хранение информации о покупках пользователя**

>Информация о покупках пользователя хранится в реляционной базе данных. Для этого используются несколько таблиц, которые связаны между собой.

![image](https://github.com/cyberlizka/-/assets/164761247/8781afaf-8f90-451d-95ad-d0bccd2f60ee)
```
@startuml
entity Users {
  userId <<PK>>
  firstName varchar(255)
  secondName varchar(255)
  email varchar(255)
  password varchar(255)
  birthDate date
}

entity Product {
  producId int <<PK>>
  name varchar(255)
  description text
  price decimal
}

entity Orders {
  orderId int <<PK>>
  userId int
  orderDate date
  status varchar(255)
}

entity OrderItem {
  id int <<PK>>
  orderId int
  productId int
  quantity int
}

entity Payment {
  paymentId int <<PK>>
  orderId int
  amount decimal
  paymentMethod varchar(255)
  paymentDate date
}

Users "1" --* "1..*" Orders : creates  **Связь один ко многим: один пользователь может создать несколько заказов**
Orders "1" --* "1..*" OrderItem : contains **Связь один ко многим: один заказ может содержать несколько товаров**
Product "1" --* "1..*" OrderItem : includes **Связь один ко многим: один товар может быть включен в несколько заказов**
Orders "1" --* "1" Payment : has **Связь один к одному: один заказ имеет одну платежную информацию**

note right of Users
  **Хранит информацию о пользователях:**
  * userId - уникальный идентификатор пользователя
  * firstName - имя пользователя
  * secondName - фамилия пользователя
  * email - электронная почта пользователя
  * password - пароль пользователя
  * birthDate - дата рождения пользователя
end note

note right of Product
  **Хранит информацию о товарах:**
  * producId - уникальный идентификатор товара
  * name - название товара
  * description - описание товара
  * price - цена товара
end note

note right of Orders
  **Хранит информацию о заказах:**
  * orderId - уникальный идентификатор заказа
  * userId - идентификатор пользователя, создавшего заказ
  * orderDate - дата создания заказа
  * status - статус заказа (например, "Оформлен", "В обработке", "Отправлен", "Доставлен")
end note

note right of OrderItem
  **Хранит информацию о товарах в заказе:**
  * id - уникальный идентификатор позиции в заказе
  * orderId - идентификатор заказа
  * productId - идентификатор товара
  * quantity - количество товара в заказе
end note

note right of Payment
  **Хранит информацию о платеже:**
  * paymentId - уникальный идентификатор платежа
  * orderId - идентификатор заказа
  * amount - сумма платежа
  * paymentMethod - способ оплаты
  * paymentDate - дата платежа
end note

@enduml
```
**Описание структуры данных**

> Users

![image](https://github.com/cyberlizka/-/assets/164761247/cf43ad01-04b7-4b14-acba-645e0a8768d0)

> Product

![image](https://github.com/cyberlizka/-/assets/164761247/827e5641-7a48-40e3-9d05-8c9f91b6c83e)

> Orders

![image](https://github.com/cyberlizka/-/assets/164761247/efe98ef4-fc5d-40c1-a5e7-6d251ff90c5a)

> OrderItem

![image](https://github.com/cyberlizka/-/assets/164761247/2e78865c-d845-48dc-80f7-d191d26ff379)

> Payment

![image](https://github.com/cyberlizka/-/assets/164761247/bddcc1a1-d9af-4395-9e64-1ad3358b371a)

**Интеграционные потоки**


*POST /orders:Создает новый заказ.*

*PUT /orders/{orderId}: Обновляет существующий заказ с идентификатором {orderId}.*

*DELETE /orders/{orderId}: Удаляет заказ с идентификатором {orderId}.*

*GET /orders/{orderId}: Получает данные заказа с идентификатором {orderId}.*

*PUT /users/{userId} Обновляет данные пользователя с идентификатором {userId}.*

*POST /orders/{orderId}/payment: Обрабатывает платеж за заказ с идентификатором {orderId}.*

*GET /users/{userId}/check: Проверяет существование пользователя с идентификатором {userId}.*

*POST /payment: передает данные о платеже.*

**Нефункциональные требования**

## 1. Требования к верстке:

Верстка страницы должна быть адаптивной, чтобы корректно отображаться на устройствах с разным разрешением экрана.
Формы для ввода информации должны быть интуитивно понятными и удобными для заполнения.
Элементы управления должны быть расположены логически и интуитивно.
Верстка должна быть оптимизирована для быстрой загрузки.

## 2. Требования к кроссбраузерности:

Страницы сайта интернет-магазина должны корректно отображаться и работать на
десктопных браузерах следующих версий:

*Десктопные браузеры:*

Для устройств с операционной системой Windows 10:

 Google Chrome: Версия 80 и выше
 Mozilla Firefox: Версия 75 и выше
 Microsoft Edge: Версия 80 и выше

Для устройств с операционной системой macOS:

Google Chrome: Версия 80 и выше
Mozilla Firefox: Версия 75 и выше

*Мобильные браузеры:*

Для устройств на базе iOS:

 Google Chrome: Версия 80 и выше

Для устройств на базе Android версии 6 и выше:

 Google Chrome: Версия 80 и выше
 Mozilla Firefox: Версия 75 и выше
 Samsung Internet: Версия 15 и выше
 Opera: Версия 60 и выше

## 3. Требования к мультиязычности и мультисайтовости:

Страница редактирования заказа должна быть доступна на русском языке.
Сайт интернет-магазина располагается на домене, реализация отдельных поддоменов не предусматривается.

## 4. Требования к скорости загрузки страниц

Страница редактирования заказа должна загружаться быстро, чтобы пользователь не тратил время на ожидание.
Скорость загрузки сайта будет оцениваться с помощью Google Lighthouse и WebPageTest.

TTFB (Time to First Byte): Должен быть менее 1 секунды для всех страниц.
TTI (Time to Interactive): Должен быть не более 3 секунд для страниц входа (главная, авторизация, карточки товаров, лендинги). 

Для страниц с тяжелой логикой (поиск, корзина, оформление заказа) TTI может быть больше. Однако, на страницах листинга товаров и в корзине не должно быть перезагрузки при применении фильтров.

При определении времени загрузки есть следующие ограничения:

1. Тестирование проводится без учета сторонних скриптов и расширений.
2. Предполагается высокоскоростное интернет-соединение.
3. Количество активных пользователей на сайте должно быть в пределах нормы.
4. Задержки при трансграничной передаче данных не учитываются.
5. Размер медиаконтента на тестируемой странице не должен превышать 5 МБ.

## 5. Целевые показатели по нагрузке

Система должна выдерживать высокую нагрузку, чтобы обеспечить бесперебойную работу функции редактирования заказа даже при одновременном использовании большим количеством пользователей.

Пользовательская нагрузка:

Максимальное количество уникальных пользователей в сутки: 200 000.
Максимальное количество одновременных пользователей: 300.

Операционная нагрузка:

Максимальное количество заказов в сутки: 2000.
Максимальное количество заказов единовременно: 100.

Хранилище данных:

Требуемый объем хранилища данных для медиа-контента: 12 ТБ.
Должна быть возможность расширения хранилища данных.

## 6. Требования к режиму функционирования

Функция редактирования заказа должна быть доступна 24/7.
Система должна работать стабильно и без ошибок.

Система должна иметь возможность функционировать в следующих режимах:
Штатный режим;
Режим администрирования.

## 7. Требования к безопасности и подходам


 Доступ к функции редактирования заказа должен быть ограничен авторизованным пользователям.
 Данные о заказах должны быть защищены от несанкционированного доступа.

Валидация данных:
  Все поля пользовательского интерфейса должны проверяться на валидность с помощью prepare-методов.
  Передача непроверенных данных на сервер запрещена.

Защита от SQL-инъекций:
  Запрещены прямые запросы к базе данных в коде сайта.
  Все запросы к базе должны выполняться на серверной части и быть изолированными от пользовательского интерфейса.

Защита от вредоносного кода:
  Необходимо организовать проверку типов файлов для предотвращения запуска вредоносного кода.

Архитектура безопасности:
  Сайт интернет-магазина должен быть построен на основе фронт-бек-база данных.
  Серверная часть и база данных должны быть разделены на отдельные серверы.

